<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Map</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'map/styles.css' %}">
</head>
<body>
    <div class="container">
        <header class="header">Liceum 66</header>
        <div class="content">
            <div class="map-wrapper">
                <div class="map-controls">
                    <label for="floor-select">Select Floor:</label>
                    <select id="floor-select">
                        {% for floor in floors %}
                            <option value="{{ floor.id }}">Floor {{ floor.floor }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="map" id="map-container">
                    {% for floor in floors %}
                        <div class="floor-map" id="floor-{{ floor.id }}" style="display: none;">
                            <img src="{{ floor.svg.url }}" alt="Floor {{ floor.floor }}">
                            <svg viewBox="0 0 1706.6667 1357.3333" id="map-svg-{{ floor.id }}">
                                {% for room in rooms %}
                                    {% if room.floor == floor %}
                                        <path class="room" id="room-{{ room.room_number }}" data-room="{{ room.room_number }}" stroke-width="5" d="{{ room.svg_path }}"/>
                                    {% endif %}
                                {% endfor %}
                            </svg>
                        </div>
                    {% endfor %}
                </div>
            </div>
            <div class="table-wrapper">
                <h2>Items in Room <span id="room-number-title"></span></h2>
                <table id="items-table">
                    <thead>
                        <tr>
                            <th class="item-number">Item Number</th>
                            <th class="item-name">Item Name</th>
                            <th class="specification">Specification</th>
                            <th class="category">Category</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <script src="{% static 'map/main.js' %}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
    const floorSelect = document.getElementById('floor-select');
    const floors = document.querySelectorAll('.floor-map');
    const roomNumberTitle = document.getElementById('room-number-title');

    // Показати перший поверх за замовчуванням
    if (floors.length > 0) {
        floors[0].style.display = 'block';
    }

    floorSelect.addEventListener('change', function() {
        const selectedFloor = this.value;

        floors.forEach(floor => {
            floor.style.display = 'none';
        });

        const floorToShow = document.getElementById('floor-' + selectedFloor);
        if (floorToShow) {
            floorToShow.style.display = 'block';
        }
    });

    const rooms = document.querySelectorAll('.room');
    rooms.forEach(room => {
        room.addEventListener('click', function() {
            const roomNumber = this.getAttribute('data-room');
            roomNumberTitle.textContent = roomNumber; // Оновлення заголовка таблиці
            fetch(`/get_room_items/${roomNumber}/`)
                .then(response => response.json())
                .then(data => {
                    const tableBody = document.querySelector('#items-table tbody');
                    tableBody.innerHTML = ''; // Clear existing rows
                    data.items.forEach(item => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${item.item_number}</td>
                            <td>${item.item_name}</td>
                            <td>${item.specification}</td>
                            <td>${item.category_name}</td>
                        `;
                        tableBody.appendChild(row);
                    });
                });
        });
    });
});
    </script>
</body>
</html>
